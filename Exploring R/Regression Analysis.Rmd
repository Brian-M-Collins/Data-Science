---
title: "Week 8 Challenge Activity"
author: "Brian Collins"
date: "11/07/2021"
output: pdf_document
---

```{r setup, include=FALSE}
library(ggplot2)
library(Hmisc)
library(knitr)
library(car)
options(scipen = 999)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=50), tidy = TRUE, message = FALSE, warning = FALSE)
```

```{r, include=FALSE}
ChildAggression <- read.csv("C:/Users/brcollins/python-work/Data-Analytics---MSc/Data Analytics & Management/Week 8 - Regression Analysis/Data/ChildAggression.dat", sep="")
```

# Draw scatter plots which demonstrate the relationship between aggression and other variables.

```{r}
scatter_tel <- ggplot(ChildAggression, aes(Television, Aggression))
scatter_tel + geom_point(shape=20, alpha=0.5) + ggtitle("Child Aggression Scores Against Television Hours Watched") + theme(plot.title=element_text(hjust=0.5)) + labs(x="Television Score", y="Aggression Score")
```
\newpage
```{r}
scatter_game <- ggplot(ChildAggression, aes(Computer_Games, Aggression))
scatter_game + geom_point(shape=20, alpha=0.5) + ggtitle("Child Aggression Scores Against Computer Game Hours") + theme(plot.title=element_text(hjust=0.5)) + labs(x="Game Time Score", y="Aggression Score")
```
\newpage
```{r}
scatter_sibagg <- ggplot(ChildAggression, aes(Sibling_Aggression, Aggression))
scatter_sibagg + geom_point(shape=20, alpha=0.5) + ggtitle("Child Aggression Scores Against Sibling Aggression Scores") + theme(plot.title=element_text(hjust=0.5)) + labs(x="Sibling Aggression Score", y="Aggression Score")
```

\newpage
```{r}
scatter_diet <- ggplot(ChildAggression, aes(Diet, Aggression))
scatter_diet + geom_point(shape=20, alpha=0.5) + ggtitle("Child Aggression Scores Against Child Diet") + theme(plot.title=element_text(hjust=0.5)) + labs(x="Diet Score", y="Aggression Score")
```
\newpage
```{r}
scatter_parentstyle <- ggplot(ChildAggression, aes(Parenting_Style, Aggression))
scatter_parentstyle + geom_point(shape=20, alpha=0.5) + ggtitle("Plotting Child Aggression Scores Against Parenting Style") + theme(plot.title=element_text(hjust=0.5)) + labs(x="Parenting Style Score", y="Aggression Score")
```
\newpage

# Create a new variable which indicates the time spent on TV and playing games then draw the scatter plot to show the relationship between the new variable and aggression.

```{r}
ChildAggression$TechTime <- ChildAggression$Television + ChildAggression$Computer_Games
scatter_techtime <- ggplot(ChildAggression, aes(TechTime, Aggression))
scatter_techtime + geom_point(shape=20, alpha=0.5) + ggtitle("Plotting Child Aggression Scores Against Technology Time") + theme(plot.title=element_text(hjust=0.5)) + labs(x="Technology Time Score", y="Aggression Score")
```
\newpage

# Find the correlation between the variables and test it using P-value. Discuss your analysis.

```{r}
AggCor <- Hmisc::rcorr(as.matrix(ChildAggression), type="pearson")
df.aggcor.r <- as.data.frame(AggCor$r)
df.aggcor.P <- as.data.frame(AggCor$P)
```

```{r, echo=FALSE}
kable(df.aggcor.r, caption="Correlation Coef for Child Aggression Dataset")
```

Reviewing the correlation coefficients in table 1 we're able to determine the following correlation coefficients noted in descending order of  correlation strength:

1. Aggression/Technology Time: 0.2268
2. Aggression/Parenting Style: 0.2107
3. Aggression/Computer Games: 0.1824
4. Aggression/Television: 0.1585
5. Aggression/Sibling Aggression: 0.1293
6. Aggression/Tech Time: -0.086
7. Aggression/Diet: -0.0086

It would be fair to say that while each of these variables has a correlation, only the first five: technology time, parenting style, computer games, television and sibling aggression, have any significant impact on the position of our dependent variable, child aggression. Even with this in mind, each of these variables ranges between a weak and moderate correlation with our target variable. 

```{r, echo=FALSE}
kable(df.aggcor.P, caption="Correlation P-Values for Child Aggression Dataset")
```
As we also know however, the correlation coefficients only tell part of the story. In order to ascertain the statistical significance of these relationships we must turn to the P-values for each of these correlations. I'll only be looking at the four variables identified above as having a weak to moderate correlation with the target variable.

1. Aggression/Tech Time: 0
2. Aggression/Parenting Style: 0
3. Aggression/Computer Games: 0.0000013
4. Aggression/Television: 0.0000394. 
5. Aggression/Sibling Aggression: 0.0008212

In each of these four cases, the P-Value is < 0.05, and as such we can reject the Null Hypothesis that the correlation between each of these independent variables and Aggression is 0.

\newpage
# If you wanted to develop a model to predict children Aggression, which variables would you choose?

As per the lecture discussion, the key with this task is to select independent variables with a degree of correlation with the dependent variable, while having a correlation with one another that are as low as possible. Based on the correlation work completed above we could argue that there are four potential independent variables that we could include in our regression analysis:

1. Technology Time
2. Parenting Style
3. Time spent paying video games
4. Time spent watching TV
5. Level of sibling aggression

By extension of the above we should now consider what levels of correlation these variables have with one another in order to determine whether they are suitable for use in our model. In order to make this task simpler we could create a new dataframe with just the values that we're interested in.

```{r}
tarvar <- df.aggcor.r[2:7,2:7]
tarvar$Diet <- NULL
tarvar <- tarvar[-4,]
```

```{r, echo=FALSE}
kable(tarvar, caption="Correlation Martix of Potential Independent Variables")
```
Reviewing these tables, we can see in the case of 2 of the variables, Computer_Games and Sibling_Aggression, correlation is low to moderate. However in the case of Television and Parenting Style we can see that the correlation is significant. Unsurprisingly, the Computer_Games and Television are closely correlated with Tech Time. As such using both of these variables in the regression analysis would likely skew the outcome of the Y prediction. Therefore we have to consider which of these variables we want to select for inclusion in the model. A potential way of completing this would be to look back at the original correlation analysis and select the variable with the highest level of correlation with our target variable, in this case, Parenting_Style.

With the above in mind that my selection for Independent Variables is:

1. Computer_Games
2. Sibling_Aggression
3. Parenting_Style

\newpage
# Develop a linear regression model and undertake required tests to evaluate its goodness of fit.

```{r}
agglrtest <- lm(Aggression ~ Computer_Games + Sibling_Aggression + Parenting_Style, data=ChildAggression)
summary(agglrtest)
```

```{r}
#Completing regression analysis with all variables in order to establish significance of all predictors
agglrall <- lm(Aggression ~ ., data=ChildAggression)
summary(agglrall)
```
From the above summary, perhaps then it would be worth considering adding Diet to the linear regression model, and then removing Television given it doesn't provide a contribution to the model within an acceptable level of probability.

```{r}
agglr <- lm(Aggression ~ Computer_Games + Sibling_Aggression + Diet + Parenting_Style, data=ChildAggression)
summary(agglr)
```
Attempting to use a stepwise model to establish best variables using AIC reduction

```{r}
fm <- lm(Aggression ~ 1, data=ChildAggression)
step(fm, direction="both", scope=formula(agglrall))
```
Conducting forward stepwise:

```{r}
step(fm, direction="forward", scope=formula(agglrall))
```
And finally backwards stepwise:

```{r}
step(agglrall, direction="backward")
```
The outcomes for the stepwise variable selection are as follows:

Direction-

**Both** = TechTime + Parenting_Style + Diet + Sibling_Aggression + Television

**Forward** = TechTime + Parenting_Style + Diet + Sibling_Aggression + Television

**Backward** = Computer_Games + Sibling_Aggression + Diet + Parenting_Style 

In order to establish which set of variables to run, I will create a model for both sets of variable combinations and then use my R2 value to establish my final selection:

```{r}
model5 <- lm(Aggression ~ TechTime + Parenting_Style + Diet + Sibling_Aggression + Television, data=ChildAggression)
summary(model5)
```
```{r}
model4 <- lm(Aggression ~ Computer_Games + Sibling_Aggression + Diet + Parenting_Style, data=ChildAggression)
summary(model4)
```
Also before making a final selection i will also test for multicollinearity given the presence of TechTIme and Television in one of the models. 

```{r}
mean(vif(model5))
```

```{r}
mean(vif(model4))
```

With an average variance inflation factor of 1.1214 in the case of the model with four predictor variables we can suggest that while multicollinearity is having a degree of impact on our regression model, we can be safe in using it to make at least preliminary predictions. Given this and the slightly lower R2 value for model4, it will be this collection of variables that will be used in my final model.


```{r}
final_model <- lm(Aggression ~ Computer_Games + Sibling_Aggression + Diet + Parenting_Style, data=ChildAggression)
ChildAggression$Standard_Residual <- rstandard(final_model)
ChildAggression$Large_Residual <- abs(ChildAggression$Standard_Residual) > 2.58
sum(ChildAggression$Large_Residual)
17/666
```
2.5% of observations within the dataset have a residual > 2.58, given that this is lower than the ideal cutoff of 5% we can suggest that the model created is a good fit for the dataset. As previously discussed however, we can also use Cook's distance to establish whether there are any outlier cases within our dataset that are affecting the fit of our model.

```{r}
ChildAggression$Cooks_Distance <- cooks.distance(final_model)
ChildAggression[ChildAggression$Cooks_Distance > 1,]
```
\newpage
# What is your model prediction for Aggression score for the record below:

```{r}
summary(final_model)
```

```{r}
prediction <- data.frame(Computer_Games=c(-0.123), Sibling_Aggression=c(1.364), Diet=c(0.753), Parenting_Style=c(-0.471))
predict(final_model, newdata=prediction)
```

Using the application of the model produced, my prediction for the new variables provided is an Aggression Score of **-0.01905107**.