---
title: 'Week 6: Correlation Analysis'
author: "Brian Collins"
date: "05/07/2021"
output: pdf_document
---

```{r setup, include=FALSE}
library(knitr)
library(formatR)
library(ggplot2)
library(Hmisc)
library(readxl)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=50), tidy = TRUE, message = FALSE, warning = FALSE)
```

```{r, echo=FALSE}
ExamAnxiety <- read.delim("D:/Data Analytics - MSc/Data Analytics & Management/Week 6/Datasets/ExamAnxiety.dat", header=TRUE)
ExamMarks <- read.delim("D:/Data Analytics - MSc/Data Analytics & Management/Week 6/Datasets/EssayMarks.dat", header=TRUE)
Film <- read_excel("D:/Data Analytics - MSc/Data Analytics & Management/Week 6/Datasets/film.xlsx")
ExamAnxiety [,5] <- NULL ##removing non-numeric data
```


# 1. Download dataset 'Exam anxiety', available on the Moodle page, and do the exercises below: 

## Draw a scatter plot between Exam and Anxiety variables. 

```{r}
AnxPlot <- ggplot(ExamAnxiety, aes(Anxiety, Exam))
AnxPlot + geom_point(colour="blue", alpha=0.6) + geom_smooth(method="lm", alpha=0.1, colour="orange", fill="orange") + ggtitle("Impact of Student Anxiety on Exam Performance") + labs(x="Student Anxiety", y="Exam Grade") + theme(plot.title=element_text(hjust=0.5))
```

## Draw a scatter plot between Exam and Revise variables. 

```{r}
AnxPlot <- ggplot(ExamAnxiety, aes(Revise, Exam))
AnxPlot + geom_point(colour="blue", alpha=0.6) + geom_smooth(method="lm", alpha=0.1, colour="orange", fill="orange") + ggtitle("Impact of Student Revision on Exam Performance") + labs(x="Revision Score", y="Exam Grade") + theme(plot.title=element_text(hjust=0.5))
```
\newpage

## Find the Pearson correlations and p-values between all the variables above. Create a table and report the correlation values. What do you understand from the table?

```{r}
AnxCor <- Hmisc::rcorr(as.matrix(ExamAnxiety), type="pearson")
df.AnxCor.p = as.data.frame(AnxCor$P)
df.AnxCor.r = as.data.frame(AnxCor$r)
kable(df.AnxCor.r, caption="Pearson Correlation Coef Values for Exam Anxiety")
```

We know that from reviewing the scatter plot comparing student anxiety to exam performance that the two are negatively correlated. That is to say that as student anxiety scores increases, exam performance decreases. This pre-existing linear relationship, alongside the lack of any extreme outliers supports the use of the Pearson correlation coef. Reviewing the table above we can state the following:

1. With a correlation coef. of 0.3967, student revision has a moderate positive correlation with exam performance.
2. With a correlation coef. of -0.4409, student anxiety has a moderate, bordering on significant, negative correlation with student exam performance.
3. With a correlation coef. of -0.7092, student revision has a strong negative correlation with exam related anxiety.

Based on the above it would be possible to suggest that significant revision might have a causal relationship with reduced exam related anxiety, which in and of itself may have a causal relationship with improved exam performance.

```{r, echo=FALSE}
kable(df.AnxCor.p, caption="Pearson Correlation P-Values for Exam Anxiety")
```

We also know that if the produced p-values are less than or equal to the significance level, then we can conclude that the correlation is statistically significant, so we can reject our null hypothesis. Based on the values for the above correlations (in the same order as above):

1. 0.0000334
2. 0.0000031
3. 0 

Given that the default significance level is 0.5 we can say in all cases that the correlations are statistically significant, and subsequently the null hypothesis can be rejected.

\newpage

# 2. Download dataset 'Essay Marks', available on the Moodle page, and do the tasks below:

## Draw a scatter plot between Essay and Hours variables.  

```{r}
MrkPlot <- ggplot(ExamMarks, aes(hours, essay))
MrkPlot + geom_point(colour="blue", alpha=0.6) + geom_smooth(method="lm", alpha=0.1, colour="orange", fill="orange") + ggtitle("Comparing Student Hours Studied to Essay Mark") + theme(plot.title=element_text(hjust=0.5))+ labs(x="Hours Studied", y="Essay Mark") 
```

## Change the variable Grade into a numerical categorical variable.
```{r}
ExamMarks$gradeno <- ifelse(ExamMarks$grade == "First Class",1,
                            ifelse(ExamMarks$grade == "Upper Second Class",2,
                                   ifelse(ExamMarks$grade == "Lower Second Class", 3, 4)))
ExamMarks$grade <- NULL
```
\newpage
## Draw the scatter plot between Essay and Grade variables.

```{r}
EssGrdPlot <- ggplot(ExamMarks, aes(gradeno, essay))
EssGrdPlot + geom_point(colour="blue", alpha=0.6) + geom_smooth(method="lm", alpha=0.1, colour="orange", fill="orange") + ggtitle("Comparing Categorical Grade Variable to Essay Marks") + theme(plot.title=element_text(hjust=0.5))+ labs(x="Categorical Grade Variable", y="Essay Mark") 
```

## Find the correlations between all three variables using appropriate methods (create a table).

```{r}
MrkCor <- Hmisc::rcorr(as.matrix(ExamMarks), type="spearman")
df.MrkCor.p = as.data.frame(MrkCor$P)
df.MrkCor.r = as.data.frame(MrkCor$r)
```

\newpage
## Explain the correlation between variables and discuss their significances

```{r, echo=FALSE}
kable(df.MrkCor.r, caption="Spearman Correlation Coef Values for Exam Marks")
```

As with the previous example reviewing anxiety data, we can establish by reviewing the scatter plot comparing student grade, when represented as an integer, to essay mark that the two are negatively correlated. That is to say that as student grade decreases,  essay mark decreases accordingly. This pre-existing linear relationship, alongside the the fact that we converted the categorical variable 'grade' into a dummy numerical value suggests that Spearman's Correlation coef is best applied here. Reviewing the table above we can state the following:

1. With a correlation coef. of 0.2115, study hours has a weak positive correlation with essay mark.
2. With a correlation coef. of -0.1931, study hours has a weak negative correlation with awarded grade category.
3. with a correlation coef. of -0.9192, essay mark has a very significant negative correlation with grade category.

From the above it might be possible to suggest that study hours may have a causal relationship with essay mark, and final awarded category. 

```{r, echo=FALSE}
kable(df.MrkCor.p, caption="Spearman Correlation P-Values for Exam Marks")
```

Based on the values for the above correlations (in the same order as above):

1. 0.1632
2. 0.2038
3. 0

Given that the default significance level is 0.5 we can say in all cases that the correlations are statistically significant, and subsequently the null hypothesis can be rejected.
\newpage

# 3. Download dataset 'Film', available on the Moodle page, and do the below tasks:

## Convert the variables into numerical variables

```{r}
Film$gender <- ifelse(Film$gender == "Female", 1, 2)
Film$film <- ifelse(Film$film == "Memento", 1, 2)
```

## Find the correlations between all three variables using appropriate methods (create a table). What do you understand from the table?

```{r}
FilmRCor <- Hmisc::rcorr(as.matrix(Film), type="spearman")
df.FilmRCor.p = as.data.frame(FilmRCor$P)
df.FilmRCor.r = as.data.frame(FilmRCor$r)
```


## Explain the correlation between variables and discuss their significance

```{r, echo=FALSE}
kable(df.FilmRCor.r, caption="Spearman Correlation Coef Values for Film Enjoyment by Gender")
```

Referring to table 5 we can determine the following:

1. With a correlation coef. of 0.1713, gender has a weak positive correlation with film enjoyment. Referring to the bar chart produced in last weeks visualization lecture (Figure 1) the dataset describes that male respondents had a higher mean enjoyment score in both cases than female respondents. Supporting this assertation.
2. With a correlation coef. of -0.6439, film is negatively correlated with enjoyment. Bearing in mind that we assigned numeric values to the films, with Memento assigned as value '1', and Bridget Jones' Diary assigned value '2'. Referring to Figure 1 we can suggest that Memento had a larger mean enjoyment score across both gender variables, supporting this significant negative correlation.

```{r, echo=FALSE}
kable(df.FilmRCor.p, caption="Spearman Correlation P-Values for Film Enjoyment by Gender")
```

Based on the values for the above correlations (in the same order as above):

1. 0.2907
2. 7.4e-06 (0.0000074)

Given that the default significance level is 0.5 we can say in all cases that the correlations are statistically significant, and subsequently the null hypothesis can be rejected.

<center>

![Figure 1]("D:/Data Analytics - MSc/Data Analytics & Management/Week 5/Capture.PNG")

</center>

# 4. Download dataset 'Trees' as one of the built-in available datasets in R:

```{r}
trees <- trees
```

## Find the correlations between all three variables using appropriate methods (create a table). What do you understand from the table?

```{r}
treecor <- Hmisc::rcorr(as.matrix(trees), type="pearson")
df.treecor.p = as.data.frame(treecor$P)
df.treecor.r = as.data.frame(treecor$r)
```

## Explain the correlation between variables and discuss their significance

```{r, echo=FALSE}
kable(df.treecor.r, caption="Pearson Correlation Coef. for Tree Variables")
```

Referring to table 7 we can determine the following:

1. With a correlation coef. of 0.5193 tree girth displays a significant positive correlation with tree height.
2. With a correlation coef. of 0.9671 tree girth displays a significant positive correlation with tree volume.
3. With a correlation coef. of 0.5982 tree height displays a significant positive correlation with tree volume.

```{r, echo=FALSE}
kable(df.treecor.p, caption="Pearson Correlation P-Values for Tree Variables")
```

Based on the values for the above correlations (in the same order as above):

1. 0.0028
2. 0
3. 0.0003

Given that the default significance level is 0.5 we can say in all cases that the correlations are statistically significant, and subsequently the null hypothesis can be rejected.
